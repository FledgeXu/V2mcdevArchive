
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../assets/retro.css">
    <script>hljs.initHighlightingOnLoad();</script>
    <title>更新到1.16后替换物品模型时报空指</title>
</head>
<body>
    <div class="title"><h1>更新到1.16后替换物品模型时报空指</h1></div>
    <div class="post-user" class="user"><h4>USS.Shenzhou</h4></div>
    <br />
    <div class="post" class="main">
        <p><strong>版本信息</strong><br>
你使用的系统：win10 2004 x64<br>
你是用的JDK: 8u251 x64<br>
你使用的IDE：IntelliJ IDEA<br>
你使用的IDE版本:2020.2<br>
Forge版本:34.1.0<br>
Minecraft版本:1.16.3<br>
Mapping 文件版本: 0916-1.16.2</p>
<p><strong>错误情况简述</strong><br>
1.15更到1.16之后，在替换item拿在手上的模型时报错，具体方法是<code>ForgeHooksClient.handlePerspective</code>，下了个断点结果如图<div class="lightbox-wrapper"><a class="lightbox" href="../uploads/default/original/1X/4b9f44f31e66bb3f9949337b32454fdb1bca60d6.png" data-download-href="../uploads/default/4b9f44f31e66bb3f9949337b32454fdb1bca60d6" title="image"><img src="../uploads/default/original/1X/4b9f44f31e66bb3f9949337b32454fdb1bca60d6.png" alt="image" data-base62-sha1="aMZ2GhXc1ylNWFqzIq7E0tjT6bY" width="517" height="144" data-small-upload="../uploads/default/optimized/1X/4b9f44f31e66bb3f9949337b32454fdb1bca60d6_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename">image</span><span class="informations">900×253 14.2 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div><br>
试着自己找是什么地方有问题，但是没找到 <img src="../images/emoji/apple/sweat.png?v=9" title=":sweat:" class="emoji" alt=":sweat:">。</p>
<p><strong>报错日志</strong></p>
<pre><code class="lang-auto">[22:17:19] [Render thread/FATAL] [minecraft/Minecraft]: Unreported exception thrown!
java.lang.NullPointerException: null
	at net.minecraftforge.client.ForgeHooksClient.handlePerspective(ForgeHooksClient.java:568) ~[forge-1.16.3-34.1.0_mapped_snapshot_20200916-1.16.2-recomp.jar:?] {re:classloading}
	at com.ussshenzhou.rainbow6.util.InventoryModelReplace$2.handlePerspective(InventoryModelReplace.java:138) ~[classes/:?] {re:classloading}
	at net.minecraftforge.client.ForgeHooksClient.handleCameraTransforms(ForgeHooksClient.java:318) ~[forge-1.16.3-34.1.0_mapped_snapshot_20200916-1.16.2-recomp.jar:?] {re:classloading}
	at net.minecraft.client.renderer.ItemRenderer.renderItem(ItemRenderer.java:98) ~[forge-1.16.3-34.1.0_mapped_snapshot_20200916-1.16.2-recomp.jar:?] {re:classloading,pl:accesstransformer:B,pl:runtimedistcleaner:A}
	at net.minecraft.client.renderer.ItemRenderer.renderItem(ItemRenderer.java:207) ~[forge-1.16.3-34.1.0_mapped_snapshot_20200916-1.16.2-recomp.jar:?] {re:classloading,pl:accesstransformer:B,pl:runtimedistcleaner:A}
	at net.minecraft.client.renderer.FirstPersonRenderer.renderItemSide(FirstPersonRenderer.java:50) ~[forge-1.16.3-34.1.0_mapped_snapshot_20200916-1.16.2-recomp.jar:?] {re:classloading,pl:runtimedistcleaner:A}
	at net.minecraft.client.renderer.FirstPersonRenderer.renderItemInFirstPerson(FirstPersonRenderer.java:393) ~[forge-1.16.3-34.1.0_mapped_snapshot_20200916-1.16.2-recomp.jar:?] {re:classloading,pl:runtimedistcleaner:A}
	at net.minecraft.client.renderer.FirstPersonRenderer.renderItemInFirstPerson(FirstPersonRenderer.java:247) ~[forge-1.16.3-34.1.0_mapped_snapshot_20200916-1.16.2-recomp.jar:?] {re:classloading,pl:runtimedistcleaner:A}
	at net.minecraft.client.renderer.GameRenderer.renderHand(GameRenderer.java:381) ~[forge-1.16.3-34.1.0_mapped_snapshot_20200916-1.16.2-recomp.jar:?] {re:classloading,pl:accesstransformer:B,pl:runtimedistcleaner:A}
	at net.minecraft.client.renderer.GameRenderer.renderWorld(GameRenderer.java:625) ~[forge-1.16.3-34.1.0_mapped_snapshot_20200916-1.16.2-recomp.jar:?] {re:classloading,pl:accesstransformer:B,pl:runtimedistcleaner:A}
	at net.minecraft.client.renderer.GameRenderer.updateCameraAndRender(GameRenderer.java:437) ~[forge-1.16.3-34.1.0_mapped_snapshot_20200916-1.16.2-recomp.jar:?] {re:classloading,pl:accesstransformer:B,pl:runtimedistcleaner:A}
	at net.minecraft.client.Minecraft.runGameLoop(Minecraft.java:979) ~[forge-1.16.3-34.1.0_mapped_snapshot_20200916-1.16.2-recomp.jar:?] {re:classloading,pl:accesstransformer:B,pl:runtimedistcleaner:A}
	at net.minecraft.client.Minecraft.run(Minecraft.java:589) ~[forge-1.16.3-34.1.0_mapped_snapshot_20200916-1.16.2-recomp.jar:?] {re:classloading,pl:accesstransformer:B,pl:runtimedistcleaner:A}
	at net.minecraft.client.main.Main.main(Main.java:184) ~[forge-1.16.3-34.1.0_mapped_snapshot_20200916-1.16.2-recomp.jar:?] {re:classloading,pl:runtimedistcleaner:A}
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_251] {}
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_251] {}
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_251] {}
	at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_251] {}
	at net.minecraftforge.userdev.FMLUserdevClientLaunchProvider.lambda$launchService$0(FMLUserdevClientLaunchProvider.java:52) ~[forge-1.16.3-34.1.0_mapped_snapshot_20200916-1.16.2-recomp.jar:?] {}
	at cpw.mods.modlauncher.LaunchServiceHandlerDecorator.launch(LaunchServiceHandlerDecorator.java:37) [modlauncher-7.0.1.jar:?] {}
	at cpw.mods.modlauncher.LaunchServiceHandler.launch(LaunchServiceHandler.java:54) [modlauncher-7.0.1.jar:?] {}
	at cpw.mods.modlauncher.LaunchServiceHandler.launch(LaunchServiceHandler.java:72) [modlauncher-7.0.1.jar:?] {}
	at cpw.mods.modlauncher.Launcher.run(Launcher.java:81) [modlauncher-7.0.1.jar:?] {}
	at cpw.mods.modlauncher.Launcher.main(Launcher.java:65) [modlauncher-7.0.1.jar:?] {}
	at net.minecraftforge.userdev.LaunchTesting.main(LaunchTesting.java:105) [forge-1.16.3-34.1.0_mapped_snapshot_20200916-1.16.2-recomp.jar:?] {}
</code></pre>
<p><strong>相关代码</strong><br>
<code>InventoryModelReplace.java</code><br>
有俩物品要换模型 所以只看一半就好了 内容和错误都是一样的</p>
<pre><code class="lang-auto">@Mod.EventBusSubscriber(bus = Mod.EventBusSubscriber.Bus.MOD,value = Dist.CLIENT)
public class InventoryModelReplace {
    @SubscribeEvent
    public static void onModelLoad(FMLClientSetupEvent event){
        ModelLoader.addSpecialModel(new ModelResourceLocation(ModItems.reinforcement.getRegistryName()+"_hand","inventory"));
        ModelLoader.addSpecialModel(new ModelResourceLocation(ModItems.blackMirrorItem.getRegistryName()+"_hand","inventory"));
    }
    @SubscribeEvent
    public static void onModelBake(ModelBakeEvent event){
        Map&lt;ResourceLocation, IBakedModel&gt; modelMap = event.getModelRegistry();
        ResourceLocation reinforcement = ModItems.reinforcement.getRegistryName();
        ResourceLocation reinforcementHand = new ModelResourceLocation(reinforcement+"_hand","inventory");
        ResourceLocation reinforcementInventory = new ModelResourceLocation(reinforcement,"inventory");
        IBakedModel reinforcementHandModel = modelMap.get(reinforcementHand);
        IBakedModel reinforcementDefaultModel = modelMap.get(reinforcementInventory);

        IBakedModel reinforcementModelWrapper = new IBakedModel() {
            @Override
            public List&lt;BakedQuad&gt; getQuads(@Nullable BlockState state, @Nullable Direction side, Random rand) {
                return reinforcementDefaultModel.getQuads(state, side, rand);
            }

            @Override
            public boolean isAmbientOcclusion() {
                return reinforcementDefaultModel.isAmbientOcclusion();
            }

            @Override
            public boolean isGui3d() {
                return reinforcementDefaultModel.isGui3d();
            }

            @Override
            public boolean isSideLit() {
                return reinforcementDefaultModel.isSideLit();
            }

            @Override
            public boolean isBuiltInRenderer() {
                return reinforcementDefaultModel.isBuiltInRenderer();
            }

            @Override
            public TextureAtlasSprite getParticleTexture() {
                return reinforcementDefaultModel.getParticleTexture();
            }

            @Override
            public ItemOverrideList getOverrides() {
                return reinforcementDefaultModel.getOverrides();
            }

            @Override
            public IBakedModel handlePerspective(ItemCameraTransforms.TransformType cameraTransformType, MatrixStack mat) {
                IBakedModel reinforcementModelToUse = reinforcementDefaultModel;
                if (cameraTransformType == ItemCameraTransforms.TransformType.FIRST_PERSON_LEFT_HAND||cameraTransformType== ItemCameraTransforms.TransformType.FIRST_PERSON_RIGHT_HAND||cameraTransformType== ItemCameraTransforms.TransformType.THIRD_PERSON_LEFT_HAND||cameraTransformType== ItemCameraTransforms.TransformType.THIRD_PERSON_RIGHT_HAND){
                    reinforcementModelToUse = reinforcementHandModel;
                }
                return ForgeHooksClient.handlePerspective(reinforcementModelToUse,cameraTransformType,mat);
            }


        };
        ResourceLocation blackMirrorItem = ModItems.blackMirrorItem.getRegistryName();
        ResourceLocation blackMirrorItemHand = new ModelResourceLocation(blackMirrorItem+"_hand","inventory");
        ResourceLocation blackMirrorItemInventory = new ModelResourceLocation(blackMirrorItem,"inventory");
        IBakedModel blackMirrorItemHandModel = modelMap.get(blackMirrorItemHand);
        IBakedModel blackMirrorItemDefaultModel = modelMap.get(blackMirrorItemInventory);

        IBakedModel blackMirrorItemModelWrapper = new IBakedModel() {
            @Override
            public List&lt;BakedQuad&gt; getQuads(@Nullable BlockState state, @Nullable Direction side, Random rand) {
                return blackMirrorItemDefaultModel.getQuads(state, side, rand);
            }

            @Override
            public boolean isAmbientOcclusion() {
                return blackMirrorItemDefaultModel.isAmbientOcclusion();
            }

            @Override
            public boolean isGui3d() {
                return blackMirrorItemDefaultModel.isGui3d();
            }

            @Override
            public boolean isSideLit() {
                return blackMirrorItemDefaultModel.isSideLit();
            }

            @Override
            public boolean isBuiltInRenderer() {
                return blackMirrorItemDefaultModel.isBuiltInRenderer();
            }

            @Override
            public TextureAtlasSprite getParticleTexture() {
                return blackMirrorItemDefaultModel.getParticleTexture();
            }

            @Override
            public ItemOverrideList getOverrides() {
                return blackMirrorItemDefaultModel.getOverrides();
            }

            @Override
            public IBakedModel handlePerspective(ItemCameraTransforms.TransformType cameraTransformType, MatrixStack mat) {
                IBakedModel blackMirrorItemModelToUse = blackMirrorItemDefaultModel;
                if (cameraTransformType == ItemCameraTransforms.TransformType.FIRST_PERSON_LEFT_HAND||cameraTransformType== ItemCameraTransforms.TransformType.FIRST_PERSON_RIGHT_HAND||cameraTransformType== ItemCameraTransforms.TransformType.THIRD_PERSON_LEFT_HAND||cameraTransformType== ItemCameraTransforms.TransformType.THIRD_PERSON_RIGHT_HAND){
                    blackMirrorItemModelToUse = blackMirrorItemHandModel;
                }
                return ForgeHooksClient.handlePerspective(blackMirrorItemModelToUse,cameraTransformType,mat);
            }


        };
        modelMap.put(blackMirrorItemInventory,blackMirrorItemModelWrapper);
        modelMap.put(reinforcementInventory,reinforcementModelWrapper);
    }
}
</code></pre>
    </div>
    <br />
    <div class="user"><h4>FledgeXu</h4></div>
    <br />
    <div class="post">
        <p>你在<code>ForgeHooksClient.handlePerspective</code>里打个断点，然后看看是哪个类为null了，然后加个判断就行了……</p>
    </div>
    <br />
    <div class="user"><h4>USS.Shenzhou</h4></div>
    <br />
    <div class="post">
        <p>噢噢我找到问题了。<code>ModelLoader.addSpecialModel</code>在1.15写在<code>FMLClientSetupEvent</code>下，1.16改到了<code>ModelRegistryEvent</code>下 <img src="../images/emoji/apple/sweat.png?v=9" title=":sweat:" class="emoji" alt=":sweat:">1.16如果写在<code>FMLClientSetupEvent</code>下的话还是会被执行，但是没什么用…</p>
    </div>
    <br />
    <div class="user"><h4>system</h4></div>
    <br />
    <div class="post">
        <p>该主题在最后一个回复创建后7天后自动关闭。不再允许新的回复。</p>
    </div>
    <br />
</body>
</html>